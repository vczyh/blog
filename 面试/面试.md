## 一. 映射关系

一对一，例如用户和学号

一对多，例如班级和学生

多对多，例如老师和学生

## 二. API

### 添加设备

```
POST /v1/equipment
```

```json
// 参数 application/json
{
	"name": "",
	"jhi_type": "",
	"model": "",
	"quantity": 0,
	"description": "",
	"com_id": ""
}
// 正常返回
{
    "code": 200,
    "msg": "success",
    // 可以将添加的信息返回，此后API类似
    "data": {
        "id": 10,
        "name": "",
		"jhi_type": "",
		"model": "",
		"quantity": "",
		"description": "",
		"com_id": "
    }
}
// 错误
{
    "code": "自定义状态码",
    "msg": "自定义返回信息"
}
```

### 删除设备

```
DELETE /v1/equipment/{id}
```

```json
{
    "code": 200,
    "msg": "success",
    "data": {
		// 删除的设备信息
    }
}
```

### 文件上传

```html
// 请求
<body>
  <input type="file" id="file"/>
  <input type="button" onclick="upload()" value="上传" />
</body>
<script>
  function upload() {
    // 获取文件
    let fileContent = document.getElementById("file").files[0]
    let formData = new FormData()
    formData.append("file", fileContent)
    // 自定义参数等信息
    formData.append("name", "example")
    formData.append("remark", "remark")
    let xhr = new XMLHttpRequest()
    // 发送
    xhr.open("POST","http://localhost:8080/v1/upload",true);
    xhr.send(formData)
  }
</script>
```

```json
// 返回
{
	"code": 200,
	"msg": "success",
	"data": {
		// 图片相关信息
	}
}
```

### 修改综合信息

```
PUT /v1/company
```

```json
// 请求
{	"id": 10,
	"admin_dept": "",
	"recep_dept": "",
	"recep_office_tel_24": "",
	"recep_mobil_24": ""
}
// 返回
{
    "code": 200,
    "msg": "success",
    "data": {
        // 公司信息
    }
}

```

### 保存按钮

依次将以上按钮的请求发出

### 取消按钮

什么也不做，前端与后端没有交互

## 三. Java 类与时序图

### Java 类

```java
@RestController
@RequestMapping("/v1")
public class TestController {

    // 添加设备
    @PostMapping("/equipment")
    public Result<Object> addEquipment(@RequestBody Equipment equipment) {
        // service => dao
        return null;
    }

    // 删除设置
    @DeleteMapping("/equipment/{id}")
    public Result<Object> delEquipment(@PathVariable Long id) {
        // service => dao
        return null;
    }

    // 文件上传
    @PostMapping("/upload")
    public Result<Object> upload(@RequestParam("file") MultipartFile file ,
                                 // 自定义图片相关参数
                                 @RequestParam("name") String name,
                                 @RequestParam("remark") String remark) {
        try {
            byte[] blob = file.getBytes();
            long fileSize = file.getSize();
            // => 保存
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }

    // 修改综合信息
    @PutMapping("/company")
    public Result<Object> modifyCompany(@RequestBody Company company) {
        // service => dao
        return null;
    }
}
```

```java
public class Company {
    private Long id;
    private String adminDept;
    private String recepDept;
    private String recepOfficeTel24;
    private String recepMobil24;

    // setter and getter
}

public class Equipment {
    private Long id;
    private String name;
    private String jhiType;
    private String model;
    private String quantity;
    private String description;
    private Long comId;

    // setter and getter
}

public class Document {
    private Long id;
    private String filename;
    private String filepath;
    private Long fileSize;
    private String md5;
    private Integer downloadTimes;
    private byte[] thumbnail;
    private String thumbnailContentType;
    private String remark;
    private String reserved;
    private String jhiType;
    private String state;
    private LocalDateTime genTime;
    private LocalDateTime updateTime;
    private LocalDateTime deTime;

    // setter and getter
}

public class PictureCase {
    private Long id;
    private String name;
    private String jhiType;
    private Integer seat;
    private String remark;
    private String reserved;
    private String state;
    private LocalDateTime genTime;
    private LocalDateTime updateTime;
    private LocalDateTime deTime;
    private Long docId;
    private Long comId;

    // setter and getter
}
```

### UML 时序图

![](http://p.vczyh.com/blog/uml.png)

## 四. SQL

```sql
select h.*, o.goods_name, sum(o.totalPrice) as totalPrice
from hospital as h 
left outer join orders as o on h.id = o.hospital_id
where o.add_time >= '2019-08-20' and o.add_time <= '2020-09-01'
group by h.id, o.goods_name;
```

